<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>youxi</title>
</head>
<body>
    <canvas id="canvas" width="500px" height="430px" style="border: 1px solid rgba(92, 255, 0, 0.75);
    background-color:rgba(155, 215, 230, 0.75); ">
    </canvas>
<script type="text/javascript">
        var canvas=document.getElementById('canvas');
        var pen=canvas.getContext("2d");
        //定义初始化的位置，运动方向，半径，定时器间隔
        var x=20;
        var y=50;
        var fx=true;
        var fy=true;
        var r=20;
        var t=5;
        var topy=50;
        //获得画布宽高，这里已经固定
        var w=canvas.width;
        var h=canvas.height;
        //初始化挡板位置居中，x2为挡板移动后x轴方向的距离
        var x1=200;
        var x2=x1;
        var head=[[0,0],[100,0],[200,0],[300,0],[400,0],
                 [0,10],[100,10],[200,10],[300,10],[400,10],
                 [0,20],[100,20],[200,20],[300,20],[400,20],
                ];
        for(var i=0;i<head.length;i++){
               get(head[i][0],head[i][1]);
        };
        draw(x,y);
        get(x1,h-10);
        //定时器
        var time=window.setInterval("move()",t);
        // //键盘按下移动挡板
        // window.onkeydown=function down(e){
        //     var keynum;
        //     keynum = window.event ? e.keyCode : e.which;
        //     if (keynum==37&&x1>=0) {
        //         x1-=4;
        //     }else if (keynum==39&&x1<=400) {
        //         x1+=4;
        //     };
        //     pen.clearRect(0,h-10,w,10);
        //     get(x1,h-10);
        //     x2=x1;
        //     };
        //按下键盘绘制移动挡板
        function get(X,Y) {
           pen.strokeStyle="rgba(19, 213, 96, 0.75)";
           pen.strokeRect(X,Y,100,10);
        };
        //绘制小球
        function draw() {
            pen.beginPath();
            //填充颜色不断变化
            pen.fillStyle="rgb("+x/2+","+x/3+","+(255-x/2-y/2)+")";
            pen.arc(x,y,r,0,Math.PI*2,true);
            pen.closePath();
            pen.fill();
        };
        //方向判断
        function move() {
            //测试
            x2=x-50;
            get(x2,h-10);
            //清除区域 上面全部 下面除了挡板区域
                area=pen.clearRect(0,topy-20,w,h-topy+10)+
                   pen.clearRect(0,h-10,x2,10)+
                   pen.clearRect(x2+100,h-10,w-x2-100,10);
            //小球在挡板左边即将碰到 判定是否进入此区域
            //实际计算x最大距离为17.3，这里向上取整，实际会有点偏差
            //主要在于在两个角上碰撞时不能精确的捕捉到
            var x3= 18>(x2-x)&&(x2-x)>0;
            //小球在挡板右边即将碰到 判定是否进入此区域
            var x4= 18>(x-x2-100)&&(x-x2-100)>0;
            //挡板区域内碰撞 fy反向
            if (fy&&y>=400&&x<=(x2+100)&&x>x2) {
                 fy=false;
            };
            //左边区域与挡板碰撞 fx反向 并退后1
            if (x3&&y>400&&fx) {
                x-=1;
                y--;
                fx=false;
            };
            //右边区域与挡板碰撞 fx反向 并退后1
            if (x4&&y>400&&fx==false) {
                x++;
                y--;
                fx=true;
            };


            //小球正常飞行方向判断
            if (fx) {
                x++;
                if (x>=(w-r)) {
                     fx=false;
                };
            }else {
                x--;
                if (x<=r) {
                    fx=true;
                }
            };
            if (fy) {
                y++;

            }else {
                y--;
                if (y<=topy) {
                    fy=true;
                }
                
            };
            header();
            draw(x,y);
            //接触到边界 清除定时器
            if (y==(h-r)){
                clearInterval(time);
                alert("你输了");
            };
        };
        var j=0;
        var flag=[1,1,1,1,1];
        var num=20;
        function header() {
            if (y<=topy&&x<=100&&flag[0]==1) {
                area+=pen.clearRect(0,num,100,10);
                    j++;
                    flag[0]=0;
                    console.log(j);

            }; 
            if (y<=topy&&x>100&&x<=200&&flag[1]==1) {
                area+=pen.clearRect(100,num,100,10);
                    j++;
                    flag[1]=0;
                    console.log(j);
            };
             if (y<=topy&&x>200&&x<=300&&flag[2]==1) {
                area+=pen.clearRect(200,num,100,10);
                    j++;
                    flag[2]=0;
                    console.log(j);
                };
             if (y<=topy&&x>300&&x<=400&&flag[3]==1) {
                area+=pen.clearRect(300,num,100,10);
                    j++;
                    flag[3]=0;
                    console.log(j);
            };
             if (y<=topy&&x>400&&x<=500&&flag[4]==1) {
                area+=pen.clearRect(400,num,100,10);
                    j++;
                    flag[4]=0;
                    console.log(j);
            };
            if (j==5) {
                num-=10;
                j=0;
                topy-=10;
                flag=[1,1,1,1,1];
            }
        };
</script>
</body>
</html>

